<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LikeSunny Header - New Scroll Effect</title>
    
    <style>
        /* Basic reset and layout styles only - NO ANIMATIONS */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: Arial, sans-serif; 
            line-height: 1.6; 
            background: white; 
        }

        /* New Scroll-Responsive Header */
        .scroll-header {
            position: sticky;
            top: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0px 4px 18px -6px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s ease-out;
        }
        
        .scroll-header-inner {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            height: 100%;
            transition: all 0.3s ease-out;
        }
        
        .scroll-logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease-out;
        }
        
        .scroll-logo {
            display: block;
            height: auto;
            transition: all 0.3s ease-out;
            object-fit: contain;
        }
        
        .scroll-header.fade-out {
            opacity: 0;
            transition: all 0.3s ease-out, opacity 2s ease-out;
        }
        
        /* Native Header - Fixed underneath */
        .native-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: #ff4444;
            box-shadow: 0px 4px 18px -6px rgba(0,0,0,0.3);
            z-index: 999; /* Lower than scroll header */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .scroll-logo-main {
            filter: brightness(0) saturate(100%) invert(46%) sepia(9%) saturate(462%) hue-rotate(64deg) brightness(95%) contrast(91%);
        }
        
        /* Content area */
        .content-section {
            height: 300vh;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            padding: 50px 20px;
        }
        
        .content-block {
            max-width: 800px;
            margin: 0 auto 100px auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .content h1 { 
            font-size: 3rem; 
            margin-bottom: 20px; 
        }
        
        .content p { 
            font-size: 1.2rem; 
            margin-bottom: 30px; 
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .likesunny-logo-column {
                width: 95vw;
            }
            
            .likesunny-header-wrap {
                padding: 8vh 0; /* 手機版使用視窗高度 */
            }
            
            .likesunny-outer-content-wrap {
                padding: 0 15px;
            }
        }
        
        /* Demo info panel */
        .demo-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 350px;
            z-index: 2000;
        }
        
        .demo-info h3 {
            margin-bottom: 10px;
            color: #28a745;
        }
        
        .demo-info ul {
            list-style: none;
            padding: 0;
        }
        
        .demo-info li {
            margin: 5px 0;
        }
        
        .scroll-debug {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 2000;
        }
    </style>
</head>
<body>
    <!-- Native Header (Fixed, underneath) -->
    <div class="native-header">
        原生 Header (80px 高度)
    </div>

    <!-- New Scroll-Responsive Header -->
    <header class="scroll-header" id="scrollHeader">
        <div class="scroll-header-inner" id="scrollHeaderInner">
            <div class="scroll-logo-container" id="scrollLogoContainer">
                <img class="scroll-logo scroll-logo-main" id="scrollLogo" src="images/logo-large.svg" alt="Logo">
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="content-section">
        <div class="content-block">
            <h1>New Scroll-Based Header Effect</h1>
            <p>Scroll down to see the header shrink proportionally</p>
            <p>The logo maintains its aspect ratio while the header shrinks to 80px height</p>
            <p>After fade out, the red native header (80px) becomes visible</p>
            <p>Effect completes after scrolling approximately 2x the initial header height</p>
        </div>
        
        <div class="content-block">
            <h2>How it Works</h2>
            <p>• Sticky positioning keeps header visible</p>
            <p>• Scroll distance calculates shrinkage percentage</p>
            <p>• Logo scales proportionally with header</p>
            <p>• Smooth CSS transitions for fluid motion</p>
        </div>
        
        <div class="content-block">
            <h2>Continue Scrolling</h2>
            <p>Keep scrolling to see the effect in action...</p>
            <p>The header will maintain its compact size.</p>
        </div>
    </div>

    <!-- Scroll Debug Info -->
    <div class="scroll-debug" id="scrollDebug">
        Scroll: 0px<br>
        Progress: 0%<br>
        Header Height: 0px
    </div>

    <!-- Demo info panel -->
    <div class="demo-info">
        <h3>New Scroll Effect Demo</h3>
        <ul>
            <li>✓ Phase 1: Shrinking (no reverse)</li>
            <li>✓ Phase 2: Header fade out</li>
            <li>✓ Logo vertical centering</li>
            <li>✓ Native header underneath (red)</li>
            <li>✓ 80px height fixed positioning</li>
            <li>✓ Progress tracking (max reached)</li>
            <li>✓ Smooth CSS transitions</li>
            <li>🔴 Red native header visible after fade</li>
        </ul>
    </div>

    <script>
        // New scroll-based header shrinking effect
        class ScrollHeaderEffect {
            constructor() {
                this.header = document.getElementById('scrollHeader');
                this.headerInner = document.getElementById('scrollHeaderInner');
                this.logoContainer = document.getElementById('scrollLogoContainer');
                this.logo = document.getElementById('scrollLogo');
                this.debugPanel = document.getElementById('scrollDebug');
                
                // Configuration
                this.initialHeaderHeight = null;
                this.finalHeaderHeight = 80;
                this.scrollMultiplier = 2; // 滾動2倍高度完成縮小
                this.hasTriggeredFadeOut = false;
                
                // Two-phase animation state
                this.phase1Complete = false; // 第一階段：縮小（不可逆）
                this.maxProgressReached = 0; // 記錄到達過的最大進度
                
                this.init();
            }
            
            init() {
                // Reset scroll position to prevent browser restore behavior
                window.scrollTo(0, 0);
                
                // Calculate initial header height
                this.calculateInitialHeight();
                
                // Set initial styles
                this.setInitialStyles();
                
                // Bind scroll listener
                window.addEventListener('scroll', () => this.handleScroll());
                window.addEventListener('resize', () => this.handleResize());
                
                console.log('ScrollHeaderEffect initialized, scroll reset to 0');
            }
            
            calculateInitialHeight() {
                // Calculate based on viewport and content
                const viewportHeight = window.innerHeight;
                const viewportWidth = window.innerWidth;
                
                // Use 5vh for desktop, 8vh for mobile as base padding
                const isMobile = viewportWidth <= 768;
                const basePadding = isMobile ? viewportHeight * 0.08 : viewportHeight * 0.05;
                
                // Logo dimensions calculation
                const logoWidth = isMobile ? viewportWidth * 0.95 : viewportWidth * 0.9;
                const logoMaxHeight = 248;
                
                // Calculate logo height based on aspect ratio (1152x122 = 0.1059)
                const logoAspectRatio = 122 / 1152;
                const calculatedLogoHeight = Math.min(logoWidth * logoAspectRatio, logoMaxHeight);
                
                // Total header height = padding top + logo height + padding bottom
                this.initialHeaderHeight = (basePadding * 2) + calculatedLogoHeight;
                
                console.log('Initial header height:', this.initialHeaderHeight);
            }
            
            setInitialStyles() {
                const viewportWidth = window.innerWidth;
                const isMobile = viewportWidth <= 768;
                
                // Set header height
                this.header.style.height = this.initialHeaderHeight + 'px';
                
                // Set logo container width
                const logoWidth = isMobile ? viewportWidth * 0.95 : viewportWidth * 0.9;
                this.logoContainer.style.width = logoWidth + 'px';
                
                // Set logo max height
                this.logo.style.maxHeight = '248px';
                this.logo.style.width = '100%';
            }
            
            handleScroll() {
                const scrollY = window.scrollY;
                const maxScrollDistance = this.initialHeaderHeight * this.scrollMultiplier;
                
                // Calculate current progress (0 to 1)
                let currentProgress = Math.min(scrollY / maxScrollDistance, 1);
                
                // Phase 1: Shrinking (no reverse) - 只向前，不允許逆轉
                if (!this.phase1Complete) {
                    // 只允許進度向前，不允許倒退
                    if (currentProgress > this.maxProgressReached) {
                        this.maxProgressReached = currentProgress;
                    }
                    
                    // 使用到達過的最大進度
                    let phase1Progress = this.maxProgressReached;
                    
                    // Apply easing for smoother effect
                    phase1Progress = this.easeOutCubic(phase1Progress);
                    
                    // Calculate current header height
                    const currentHeight = this.initialHeaderHeight - (
                        (this.initialHeaderHeight - this.finalHeaderHeight) * phase1Progress
                    );
                    
                    // Apply transformations
                    this.applyScrollTransform(phase1Progress, currentHeight);
                    
                    // Check if phase 1 is complete
                    if (this.maxProgressReached >= 1) {
                        this.phase1Complete = true;
                        console.log('Phase 1 complete: Header shrunk to minimum size');
                    }
                    
                    // Update debug info for phase 1
                    this.updateDebugInfo(scrollY, phase1Progress, currentHeight, 'Phase 1: Shrinking');
                } 
                // Phase 2: Fade out - 當第一階段完成後
                else {
                    // 第一階段已完成，現在處理淡出
                    if (!this.hasTriggeredFadeOut) {
                        this.triggerHeaderFadeOut();
                    }
                    
                    // Update debug info for phase 2
                    this.updateDebugInfo(scrollY, 1, this.finalHeaderHeight, 'Phase 2: Fade Out');
                }
            }
            
            applyScrollTransform(progress, currentHeight) {
                // Update header height
                this.header.style.height = currentHeight + 'px';
                
                // Scale logo container proportionally
                const scale = currentHeight / this.initialHeaderHeight;
                const viewportWidth = window.innerWidth;
                const isMobile = viewportWidth <= 768;
                const initialLogoWidth = isMobile ? viewportWidth * 0.95 : viewportWidth * 0.9;
                const currentLogoWidth = initialLogoWidth * scale;
                
                this.logoContainer.style.width = currentLogoWidth + 'px';
                
                // Update logo max height proportionally
                const currentLogoMaxHeight = 248 * scale;
                this.logo.style.maxHeight = currentLogoMaxHeight + 'px';
            }
            
            handleResize() {
                // Recalculate on resize
                this.calculateInitialHeight();
                this.setInitialStyles();
                
                // Reset animation state on resize
                this.phase1Complete = false;
                this.hasTriggeredFadeOut = false;
                this.maxProgressReached = 0;
                this.header.classList.remove('fade-out');
                
                this.handleScroll(); // Re-apply current scroll position
            }
            
            triggerHeaderFadeOut() {
                this.hasTriggeredFadeOut = true;
                
                // Add fade out class to header to trigger 2-second fade out animation
                this.header.classList.add('fade-out');
                
                console.log('Header fade out triggered');
            }
            
            easeOutCubic(t) {
                return 1 - Math.pow(1 - t, 3);
            }
            
            updateDebugInfo(scrollY, progress, currentHeight, phase = '') {
                if (this.debugPanel) {
                    this.debugPanel.innerHTML = `
                        Scroll: ${Math.round(scrollY)}px<br>
                        Progress: ${Math.round(progress * 100)}%<br>
                        Header Height: ${Math.round(currentHeight)}px<br>
                        Max Reached: ${Math.round(this.maxProgressReached * 100)}%<br>
                        ${phase}<br>
                        Fade Out: ${this.hasTriggeredFadeOut ? 'Yes' : 'No'}
                    `;
                }
            }
        }
        
        // Reset scroll position immediately
        if (window.history.scrollRestoration) {
            window.history.scrollRestoration = 'manual';
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Additional scroll reset
            window.scrollTo(0, 0);
            new ScrollHeaderEffect();
        });
        
        // Backup reset on window load
        window.addEventListener('load', function() {
            window.scrollTo(0, 0);
        });
    </script>
</body>
</html>